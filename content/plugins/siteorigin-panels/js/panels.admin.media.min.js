jQuery(function($){var originalInsert=wp.media.editor.insert;wp.media.editor.insert=function(h){if(!$('#wp-content-wrap').hasClass('panels-active'))return originalInsert(h);if($('.panel-dialog:visible').length>0)return originalInsert(h);if(h.indexOf('[gallery')!==-1){var attachments=wp.media.gallery.attachments(wp.shortcode.next('gallery',h).shortcode);var ids=attachments.models.map(function(e){return e.id});var panel=$('#panels-dialog').panelsCreatePanel('SiteOrigin_Panels_Widgets_Gallery',{'ids':ids.join(',')});if(panel==null)originalInsert(h);else panels.addPanel(panel,null,null,true);return;}
else if(h.indexOf('<a ')!==-1||h.indexOf('<img ')!==-1){var $el=$(h);var panel;if($el.prop("tagName")=='A'&&$el.children().eq(0).prop('tagName')=='IMG'){panel=$('#panels-dialog').panelsCreatePanel('SiteOrigin_Panels_Widgets_Image',{'href':$el.attr('href'),'src':$el.children().eq(0).attr('src')});}
else if($el.prop("tagName")=='IMG'){panel=$('#panels-dialog').panelsCreatePanel('SiteOrigin_Panels_Widgets_Image',{'src':$el.attr('src')});}
else if($el.prop('tagName')=='A'&&($el.attr('href').indexOf('.mp4')!==-1||$el.attr('href').indexOf('.avi')!==-1)){panel=$('#panels-dialog').panelsCreatePanel('SiteOrigin_Panels_Widgets_Video',{'url':$el.attr('href')});}
if(panel==null)originalInsert(h);else panels.addPanel(panel,null,null,true);return;}
else{var panel=$('#panels-dialog').panelsCreatePanel('WP_Widget_Text',{'text':h});if(panel==null)originalInsert(h);else panels.addPanel(panel,null,null,true);}
originalInsert(h);}
$('body').on({click:function(event){if(typeof wp==='undefined'||!wp.media||!wp.media.gallery)return;event.preventDefault();var $$=$(this);var dialog=$('.panels-admin-dialog:visible');var val=dialog.find('*[name$="[ids]"]').val();if(val.indexOf('{demo')===0||val.indexOf('{default')===0)val='-';if(val==''&&$('#post_ID').val()==null)val='-';dialog.find('.ui-dialog-content').dialog('close');var frame=wp.media.gallery.edit('[gallery ids="'+val+'"]');frame.state('gallery-edit').on('update',function(selection){dialog.find('.ui-dialog-content').dialog('open');var ids=selection.models.map(function(e){return e.id});dialog.find('input[name$="[ids]"]').val(ids.join(','));});frame.on('escape',function(){dialog.find('.ui-dialog-content').dialog('open');});return false;}},'.so-gallery-widget-select-attachments');});